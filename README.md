# Trusioo API

åŸºäº cardaegis_api é¡¹ç›®ç»“æ„åˆ›å»ºçš„ç®€åŒ–ç‰ˆ API é¡¹ç›®ï¼Œä¸“æ³¨äºè®¤è¯å’Œç®¡ç†å‘˜åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ç”¨æˆ·è®¤è¯ç³»ç»Ÿ (æ³¨å†Œã€ç™»å½•ã€JWTä»¤ç‰Œ)
- ç®¡ç†å‘˜è®¤è¯ç³»ç»Ÿ (ç™»å½•ã€ç”¨æˆ·ç®¡ç†)
- **ğŸ†• å›¾ç‰‡å­˜å‚¨å’Œå¤„ç†ç³»ç»Ÿ**
  - Cloudflare R2 å­˜å‚¨æ¡¶é›†æˆ
  - CDN åŠ é€Ÿè®¿é—®
  - è‡ªåŠ¨å›¾ç‰‡å‹ç¼©å’Œä¼˜åŒ–
  - å…¬æœ‰/ç§æœ‰å­˜å‚¨åˆ†ç¦»
  - æ”¯æŒå¤šç§å›¾ç‰‡æ ¼å¼ (JPEG, PNG, GIF, WebP)
- é“¶è¡Œå¡æ£€æµ‹åŠŸèƒ½
- åŸºç¡€çš„ç”¨æˆ·ç®¡ç†åŠŸèƒ½
- PostgreSQL æ•°æ®åº“æ”¯æŒ
- Redis ç¼“å­˜æ”¯æŒ
- RESTful API è®¾è®¡
- å®Œæ•´çš„å®‰å…¨é…ç½®

## é¡¹ç›®ç»“æ„

```
trusioo_api/
â”œâ”€â”€ cmd/                    # åº”ç”¨ç¨‹åºå…¥å£
â”‚   â””â”€â”€ main.go
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ config.go
â”œâ”€â”€ internal/               # å†…éƒ¨ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ auth/              # ç”¨æˆ·è®¤è¯æ¨¡å—
â”‚   â”œâ”€â”€ admin/             # ç®¡ç†å‘˜æ¨¡å—
â”‚   â”œâ”€â”€ common/            # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚   â””â”€â”€ router/            # è·¯ç”±é…ç½®
â”œâ”€â”€ pkg/                   # å¯é‡ç”¨çš„åŒ…
â”‚   â”œâ”€â”€ auth/             # JWT è®¤è¯å·¥å…·
â”‚   â”œâ”€â”€ database/         # æ•°æ®åº“è¿æ¥
â”‚   â””â”€â”€ logger/           # æ—¥å¿—å·¥å…·
â”œâ”€â”€ scripts/              # æ•°æ®åº“è„šæœ¬
â”‚   â””â”€â”€ init_db.sql      # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ docs/                 # æ–‡æ¡£ç›®å½•
â”œâ”€â”€ static/              # é™æ€æ–‡ä»¶
â”œâ”€â”€ tools/               # ç®¡ç†å’Œç»´æŠ¤å·¥å…·
â”‚   â”œâ”€â”€ db/             # æ•°æ®åº“å·¥å…·
â”‚   â”œâ”€â”€ admin/          # ç®¡ç†å‘˜å·¥å…·
â”‚   â”œâ”€â”€ debug/          # è°ƒè¯•å·¥å…·
â”‚   â””â”€â”€ README.md       # å·¥å…·ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ .env.example         # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore          # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ go.mod              # Go æ¨¡å—æ–‡ä»¶
â””â”€â”€ README.md           # é¡¹ç›®è¯´æ˜
```

## å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd trusioo_api
```

### 2. å®‰è£…ä¾èµ–

```bash
go mod tidy
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯ç­‰
```

### 4. åˆå§‹åŒ–æ•°æ®åº“

åˆ›å»º PostgreSQL æ•°æ®åº“ï¼Œç„¶åæ‰§è¡Œåˆå§‹åŒ–è„šæœ¬ï¼š

```bash
psql -U postgres -d trusioo_db -f scripts/init_db.sql
```

### 5. è¿è¡Œé¡¹ç›®

```bash
go run cmd/main.go
```

æœåŠ¡å°†åœ¨ `http://localhost:8080` å¯åŠ¨ã€‚

## ç®¡ç†å·¥å…·

é¡¹ç›®æä¾›äº†ä¸°å¯Œçš„ç®¡ç†å’Œç»´æŠ¤å·¥å…·ï¼Œä½äº `tools/` ç›®å½•ï¼š

```bash
cd tools

# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å·¥å…·
make help

# æ•°æ®åº“ç›¸å…³å·¥å…·
make db-migrate    # æ‰§è¡Œæ•°æ®åº“è¿ç§»
make db-test       # æµ‹è¯•æ•°æ®åº“è¿æ¥
make db-verify     # éªŒè¯è¡¨ç»“æ„

# ç®¡ç†å‘˜å·¥å…·
make admin-check   # æ£€æŸ¥ç®¡ç†å‘˜å¯†ç 

# è°ƒè¯•å·¥å…·
make debug-data    # æ£€æŸ¥æ•°æ®ç»Ÿè®¡
```

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š[tools/README.md](tools/README.md)

## API æ¥å£

### ç”¨æˆ·è®¤è¯

- `POST /api/v1/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/v1/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/v1/auth/refresh` - åˆ·æ–°ä»¤ç‰Œ
- `GET /api/v1/auth/profile` - è·å–ç”¨æˆ·èµ„æ–™ (éœ€è¦è®¤è¯)

### ç®¡ç†å‘˜

- `POST /api/v1/admin/auth/login` - ç®¡ç†å‘˜ç™»å½•
- `POST /api/v1/admin/auth/refresh` - åˆ·æ–°ç®¡ç†å‘˜ä»¤ç‰Œ
- `GET /api/v1/admin/profile` - è·å–ç®¡ç†å‘˜èµ„æ–™ (éœ€è¦è®¤è¯)
- `GET /api/v1/admin/users/stats` - è·å–ç”¨æˆ·ç»Ÿè®¡ (éœ€è¦ç®¡ç†å‘˜è®¤è¯)
- `GET /api/v1/admin/users` - è·å–ç”¨æˆ·åˆ—è¡¨ (éœ€è¦ç®¡ç†å‘˜è®¤è¯)
- `GET /api/v1/admin/users/{id}` - è·å–ç”¨æˆ·è¯¦æƒ… (éœ€è¦ç®¡ç†å‘˜è®¤è¯)

### å¥åº·æ£€æŸ¥

- `GET /health` - å¥åº·æ£€æŸ¥

## é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·

- é‚®ç®±: `admin@trusioo.com`
- å¯†ç : `admin123`

## å¼€å‘è¯´æ˜

### æ•°æ®åº“è¡¨ç»“æ„

- `users` - ç”¨æˆ·è¡¨
- `admins` - ç®¡ç†å‘˜è¡¨
- `user_refresh_tokens` - ç”¨æˆ·åˆ·æ–°ä»¤ç‰Œè¡¨
- `admin_refresh_tokens` - ç®¡ç†å‘˜åˆ·æ–°ä»¤ç‰Œè¡¨
- `user_login_sessions` - ç”¨æˆ·ç™»å½•ä¼šè¯è¡¨
- `admin_login_sessions` - ç®¡ç†å‘˜ç™»å½•ä¼šè¯è¡¨
- `verifications` - éªŒè¯ç è¡¨ (é¢„ç•™)

### è®¤è¯æœºåˆ¶

- ä½¿ç”¨ JWT è¿›è¡Œèº«ä»½è®¤è¯
- è®¿é—®ä»¤ç‰Œé»˜è®¤æœ‰æ•ˆæœŸ 2 å°æ—¶
- åˆ·æ–°ä»¤ç‰Œé»˜è®¤æœ‰æ•ˆæœŸ 7 å¤©
- æ”¯æŒç”¨æˆ·å’Œç®¡ç†å‘˜åˆ†ç¦»çš„è®¤è¯ä½“ç³»

### ç¯å¢ƒå˜é‡

ä¸»è¦ç¯å¢ƒå˜é‡è¯´æ˜ï¼š

- `DB_HOST` - æ•°æ®åº“ä¸»æœº
- `DB_PORT` - æ•°æ®åº“ç«¯å£
- `DB_USER` - æ•°æ®åº“ç”¨æˆ·å
- `DB_PASSWORD` - æ•°æ®åº“å¯†ç 
- `DB_NAME` - æ•°æ®åº“åç§°
- `JWT_SECRET` - JWT è®¿é—®ä»¤ç‰Œå¯†é’¥
- `JWT_REFRESH_SECRET` - JWT åˆ·æ–°ä»¤ç‰Œå¯†é’¥
- `PORT` - æœåŠ¡ç«¯å£

## License

MIT License