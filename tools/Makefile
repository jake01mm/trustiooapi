# Trusioo API Tools
# æ•°æ®åº“å’Œç®¡ç†å·¥å…·é›†åˆ

.PHONY: help db-init db-migrate db-rollback db-status db-create db-force db-drop db-backup db-restore db-test db-verify admin-check debug-data

help:
	@echo "=== Trusioo API æ•°æ®åº“å·¥å…· ==="
	@echo "è¿ç§»ç®¡ç†ï¼š"
	@echo "  db-init          - åˆå§‹åŒ–æ•°æ®åº“å’Œè¿ç§»ç³»ç»Ÿ"
	@echo "  db-migrate       - æ‰§è¡Œæ‰€æœ‰å¾…å¤„ç†çš„è¿ç§»"
	@echo "  db-rollback      - å›æ»šæœ€åä¸€ä¸ªè¿ç§»"
	@echo "  db-rollback-n N  - å›æ»šNä¸ªè¿ç§»"
	@echo "  db-status        - æ˜¾ç¤ºå½“å‰è¿ç§»ç‰ˆæœ¬çŠ¶æ€"
	@echo "  db-create NAME   - åˆ›å»ºæ–°çš„è¿ç§»æ–‡ä»¶"
	@echo "  db-force N       - å¼ºåˆ¶è®¾ç½®è¿ç§»ç‰ˆæœ¬ï¼ˆå±é™©æ“ä½œï¼‰"
	@echo "  db-drop          - åˆ é™¤æ‰€æœ‰è¡¨ï¼ˆå±é™©æ“ä½œï¼‰"
	@echo "  db-backup        - åˆ›å»ºæ•°æ®åº“å¤‡ä»½"
	@echo "  db-restore FILE  - ä»å¤‡ä»½æ¢å¤ï¼ˆå±é™©æ“ä½œï¼‰"
	@echo ""
	@echo "å…¶ä»–å·¥å…·ï¼š"
	@echo "  db-test          - æµ‹è¯•æ•°æ®åº“è¿æ¥"
	@echo "  db-verify        - éªŒè¯æ•°æ®åº“è¡¨ç»“æ„"
	@echo "  admin-check      - æ£€æŸ¥å’Œä¿®å¤ç®¡ç†å‘˜å¯†ç "
	@echo "  debug-data       - æ£€æŸ¥è¡¨ä¸­çš„æ•°æ®ç»Ÿè®¡"
	@echo ""
	@echo "ç¤ºä¾‹ï¼š"
	@echo "  make db-create NAME=add_user_preferences"
	@echo "  make db-rollback-n N=2"
	@echo "  make db-force N=1"

db-init:
	@echo "ğŸ”§ åˆå§‹åŒ–æ•°æ®åº“å’Œè¿ç§»ç³»ç»Ÿ..."
	@go run db/init/main.go

db-migrate:
	@echo "ğŸš€ æ‰§è¡Œæ•°æ®åº“è¿ç§»..."
	@go run db/migrate/main.go -action=up

db-rollback:
	@echo "â¬‡ï¸  å›æ»šæœ€åä¸€ä¸ªè¿ç§»..."
	@go run db/migrate/main.go -action=down -steps=1

db-rollback-n:
	@echo "â¬‡ï¸  å›æ»š $(N) ä¸ªè¿ç§»..."
	@go run db/migrate/main.go -action=down -steps=$(N)

db-status:
	@go run db/status/main.go

db-create:
	@echo "ğŸ“ åˆ›å»ºæ–°è¿ç§»: $(NAME)"
	@go run db/migrate/main.go -action=create -name="$(NAME)"

db-force:
	@echo "âš¡ å¼ºåˆ¶è®¾ç½®è¿ç§»ç‰ˆæœ¬åˆ° $(N)..."
	@go run db/migrate/main.go -action=force -force=$(N)

db-drop:
	@echo "ğŸ—‘ï¸  åˆ é™¤æ‰€æœ‰è¡¨..."
	@read -p "ç¡®å®šè¦åˆ é™¤æ‰€æœ‰è¡¨å—ï¼Ÿè¿™å°†æ¸…ç©ºæ•´ä¸ªæ•°æ®åº“ï¼è¾“å…¥ 'yes' ç¡®è®¤: " confirm && [ "$$confirm" = "yes" ]
	@go run db/migrate/main.go -action=drop

db-backup:
	@echo "ğŸ“¦ åˆ›å»ºæ•°æ®åº“å¤‡ä»½..."
	@go run db/backup/main.go -action=backup

db-restore:
	@echo "ğŸ”„ ä»å¤‡ä»½æ¢å¤æ•°æ®åº“..."
	@go run db/backup/main.go -action=restore -file="$(FILE)"

db-test:
	@echo "æµ‹è¯•æ•°æ®åº“è¿æ¥..."
	@go run db/legacy/test/test.go

db-verify:
	@echo "éªŒè¯æ•°æ®åº“è¡¨ç»“æ„..."
	@go run db/legacy/verify/verify.go

admin-check:
	@echo "æ£€æŸ¥ç®¡ç†å‘˜è´¦æˆ·..."
	@go run admin/check_password.go

debug-data:
	@echo "æ£€æŸ¥è¡¨æ•°æ®..."
	@go run debug/check_data/main.go